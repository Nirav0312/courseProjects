# extract bytecode and save into a file in same folder
import os
import pickle

if __name__ == "__main__":

    base_path="data//Static_Analysis_RAWDATA//Malware"

    folders_category = os.listdir(base_path)

    opcode = "Opcodes.txt"
    code_only = "code"

    max_so_far = 0
    files = 0
    i=0
    for category in folders_category:
        # print(category)
        folders = os.listdir(base_path+"//"+category)

        for folder in folders:
            file_path = base_path + "//" + category + "//" + folder+"//"+opcode
            write_into = base_path + "//" + category + "//" + folder+"//"+code_only

            # print(file_path)

            with open(file_path, errors='ignore') as all_lines:
                code = [line[9:32].strip().split(" ")[0]
                            for line in all_lines
                                    if not (
                                    "." in line[9:32].strip() or
                                    "<" in line[9:32].strip() or
                                    ":" in line[9:32].strip() or
                                    ">" in line[9:32].strip() or
                                    line[9:32].strip() == ''
                                    )
                        ]

                # print(code[:100])
                filehandler = open(write_into, "wb")
                pickle.dump(code, filehandler)
                print(i)
                i += 1
