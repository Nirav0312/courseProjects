import os
import pickle
import numpy as np

if __name__ == "__main__":


    base_path="data//Static_Analysis_RAWDATA"
    benign = "Benign"
    opcode = "Opcodes.txt"
    code_only = "code"

    folders = os.listdir(base_path+"//"+benign)

    folders = sorted(folders)

    feature_Set = set()
    zero_len_files = list()

    l=0

    for folder in folders:
        write_into = base_path+"//"+benign+"//"+folder+"//"+code_only
        with open(write_into, 'rb') as pickle_file:
            list_opcode = pickle.load(pickle_file)

            if(len(list_opcode)==0):
                # print("zero size: "+write_into)
                zero_len_files.append(write_into)

            feature_Set.update(''.join(list_opcode[i:i+3]) for i in range(len(list_opcode)-2))
            # print(list(feature_Set)[-10:])


            l+=1
            print("l="+str(l))
            print("total features=:" + str(len(feature_Set)))


    # with open("E://data//Nirav//M.tech//cs698//data//Static_Analysis_RAWDATA//feature_set_benign", 'wb') as file:
    #     pickle.dump(feature_Set, file)
    #
    # print("final total features=:" + str(len(feature_Set)))
    # print(len(zero_len_files))
    #
    # with open("E://data//Nirav//M.tech//cs698//data//Static_Analysis_RAWDATA//empty_ben", 'wb') as file:
    #     pickle.dump(zero_len_files, file)