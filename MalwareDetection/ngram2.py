import os
import pickle
import numpy as np

if __name__ == "__main__":

    base_path = "data//Static_Analysis_RAWDATA//Malware"
    code_only = "code"

    folders_category = os.listdir(base_path)
    folders_category = sorted(folders_category)

    feature_Set = set()

    l=0

    zero_len_files = list()

    for category in folders_category:
        # print(category)
        folders = os.listdir(base_path + "//" + category)

        for folder in folders:

            write_into = base_path + "//" + category + "//" + folder + "//" + code_only

            with open(write_into, 'rb') as pickle_file:
                list_opcode = pickle.load(pickle_file)

                if(len(list_opcode)==0):
                    print("zero size: "+write_into)
                    zero_len_files.append(write_into)

                feature_Set.update(''.join(list_opcode[i:i+3]) for i in range(len(list_opcode)-2))

                l+=1
                print("l="+str(l))
                print("total features=:" + str(len(feature_Set)))


    with open("data//Static_Analysis_RAWDATA//feature_set_malware", 'wb') as file:
        pickle.dump(feature_Set, file)

    print("total features=:" + str(len(feature_Set)))
    print(zero_len_files)

    with open("data//Static_Analysis_RAWDATA//empty_mal", 'wb') as file:
        pickle.dump(zero_len_files, file)